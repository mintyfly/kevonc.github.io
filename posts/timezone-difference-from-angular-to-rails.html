
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Timezone Difference from Angular to Rails | kevon's blog | life, startup, and code</title>
    
      <meta name="description" content="Everyday is a lesson when your knowledge and experience contribute to it.">
    
    <meta name="author" content="Kevon Cheung">

    <!-- Open Graph data -->
    <meta property="og:site_name" content="kevon's blog | life, startup, and code" />
    <meta property="og:title" content="kevon's blog | life, startup, and code" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://www.kevoncheung.com/" />
    <meta property="og:image" content="http://kevoncheung.com/assets/images/logo.png" />
    <meta property="og:description" content="Everyday is a lesson when your knowledge and experience contribute to it." />

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="icon" type="image/png" href="/assets/images/favicon.png" />

    <link rel="stylesheet" href="/assets/css/pygments.css">

    <!-- Le styles -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link href="/assets/css/styles.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-43131706-4', 'kevoncheung.com');
      ga('send', 'pageview');

    </script>

  </head>

  <body>
    <div class="container-narrow">
      <div class="row">
        <div class="col-xs-12 col-sm-3">
          <div class="navi">
	<a href="/">
	  <img src="/assets/images/kevon.jpg" alt="kevon's blog" class="main-avatar">
	</a>

	<a href="/">
		<h4>Kevon Cheung</h4>
	</a>

	<h5>Everyday is a lesson. This is where I share about life, startup, and code.</h5>

	<ul class="nav">
		<li><a href="/about">About</a></li>
		<li><a href="/contact">Contact</a></li>
		<li><a href="/projects">Projects</a></li>
		<li><a href="/videos">Videos</a></li>
	  <li></li>
	  <li></li>
	  <li>


  
    
      
      	
      	<li><a href="/archive">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
      	
      	<li><a href="/tags">Tags</a></li>
      	
      
    
  


</li>
	</ul>
</div>
        </div>
        <div class="col-xs-12 col-sm-9">
          <div class="content">
            
<div class="page-header">
  <h4 class="title">Timezone Difference from Angular to Rails</h4>
  <span class="date">June 18, 2014</span>
</div>

<div class="post-full">
  <div class="post-content">
    
    <p>Lately I have been working on an internal project at Favorite Medium that uses Angular JS for web interface and Rails for API. I use this stack because I was desperate to learn Angular JS, and I prove my desire right by liking Angular JS a lot. I encountered one issue regarding how Angular and Rails interpret time differently based on timezone and it reverts any date I input in the form by a day. This is how I solve it.</p>

<p>In the app, there are multiple date fields, here letâ€™s say Date of Birth. The user inputs his DOB on a form and sends a request to the Rails API to update the record, straight forward enough. The problem I was having was a time difference issue: when a user inputs March 1st, 1990 as his DOB, Angular interprets it as 1990-03-01 00:00 along with your time zone of +08 00. The date reaches Rails and because it is using UTC, it flips the time 8 hours back so that the datetime is now 1990-02-28 16:00, and if your database column is Date, it will save as 1990-02-28, missing one day! It was quite an annoying issue because I do not care about the time zone difference, I simply want to state a correct date.</p>

<p>Coming to the conclusion, I decided to modify the datetime on client side to make up for the timezone difference. I wrote a Date service with a function to add the timezone offset.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">addTimezoneDiff</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">timeDiff</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTimezoneOffset</span><span class="p">());</span>
    <span class="nx">angular</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">.</span><span class="nx">getMonth</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">value</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="nx">timeDiff</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="k">return</span> <span class="nx">object</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Basically what it does is instead of passing 1990-03-01 00:00, it passes 1990-03-01 08:00 to Rails and Rails will fix it by flipping it back to 1990-03-01 00:00. To be honest, I do not like this approach and I beleive there is a better way. I am happy to take any advice if any of you stumble upon my post; in the meanwhile, this works for me.</p>

<p>###UPDATES:
I posted the question on <a href="http://stackoverflow.com/questions/24298997/timezone-offset-in-angular-js-and-rails">StackOverflow</a> and received a better solution from <a href="http://stackoverflow.com/users/634824/matt-johnson">Matt Johnson</a>.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">dt</span> <span class="o">=</span> <span class="c1">//  whatever Date object you get from the control</span>
<span class="nx">dt</span><span class="p">.</span><span class="nx">setHours</span><span class="p">(</span><span class="nx">dt</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span> <span class="c1">// adjust to noon</span>
<span class="kd">var</span> <span class="nx">pad</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">?</span> <span class="s1">&#39;0&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">n</span><span class="p">;</span> <span class="p">}</span>
<span class="kd">var</span> <span class="nx">dob</span> <span class="o">=</span> <span class="nx">dt</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">pad</span><span class="p">(</span><span class="nx">dt</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">pad</span><span class="p">(</span><span class="nx">dt</span><span class="p">.</span><span class="nx">getDate</span><span class="p">());</span></code></pre></figure>


    <div class="social">
      Follow me on <a href="https://www.instagram.com/kevon/" target="_blank">Instagram</a> if you would like to get updates on my blog.
    </div>
  </div>

  <div class="pagination">
    <ul>
    
      <li class="next"><a href="/posts/what-a-developer-should-expect-working-in-an-agency" title="What a Developer / Programmer / Software Engineer Should Expect Working in an Agency">Next Post: What a Developer / Programmer / Software Engineer Should Expect Working in an Agency</a></li>
    
    
      <li class="prev"><a href="/posts/why-you-should-work-overseas-in-your-early-career" title="Why You Should Work Overseas in Your Early Career">Last Post: Why You Should Work Overseas in Your Early Career</a></li>
    
    </ul>
  </div>

  <div class="tag-boxes">
    
      <ul class="tag-box inline">
        <li><span class="glyphicon glyphicon-leaf"></span></li>
        
        


  
     
    	<li><a href="/categories.html#webdev-ref">
    		webdev <span>23</span>
    	</a></li>
    
  


      </ul>
    

    
      <ul class="tag-box inline">
        <li><span class="glyphicon glyphicon-tags"></span></li>
        
        


  
     
    	<li><a href="/tags.html#coding rails angular-ref">coding rails angular <span>1</span></a></li>
    
  



      </ul>
    
  </div>

  


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'kevonc'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</div>


          </div>
        </div>
        <div class="col-xs-12">
          <hr>
          <footer>
  <p>&copy; 2016 <a href="http://kevoncheung.com">Kevon Cheung</a></p>
  <a href="https://www.instagram.com/kevon/" target="_blank"><img class="social-icon" src="/assets/images/social/instagram.png" alt="Instagram"></a>
  <a href="https://www.facebook.com/kevon69" target="_blank"><img class="social-icon" src="/assets/images/social/facebook.png" alt="Facebook"></a>
  <a href="http://hk.linkedin.com/in/kevoncheung/" target="_blank"><img class="social-icon" src="/assets/images/social/linkedin.png" alt="LinkedIn"></a>
  <a href="https://github.com/kevonc" target="_blank"><img class="social-icon" src="/assets/images/social/github.png" alt="Github"></a>
  <a href="https://twitter.com/kevon69" target="_blank"><img class="social-icon" src="/assets/images/social/twitter.png" alt="Twitter"></a>
</footer>
        </div>
      </div>
    </div>
    
  </body>
</html>

